<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 1400" width="1200" height="1400">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#f03e3e" />
    </marker>
  </defs>
  
  <style>
    .title { font: bold 32px Arial; fill: #1e1e1e; }
    .section-title { font: bold 22px Arial; fill: #1971c2; }
    .label { font: 16px Arial; fill: #495057; }
    .label-bold { font: bold 16px Arial; fill: #1e1e1e; }
    .code { font: 15px 'Courier New', monospace; fill: #1e1e1e; }
    .formula { font: bold 18px 'Courier New', monospace; fill: #c92a2a; }
    .highlight { font: bold 16px Arial; fill: #f76707; }
    .arrow-label { font: bold 14px Arial; fill: #f03e3e; }
  </style>
  
  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" class="title">How to Calculate Global Thread Index</text>
  <text x="600" y="70" text-anchor="middle" class="label" fill="#868e96">Understanding the grid ‚Üí block ‚Üí thread hierarchy</text>
  
  <!-- ============ STEP 1: The Grid ============ -->
  <text x="50" y="120" class="section-title">Step 1: Grid of Blocks (4 blocks in a row)</text>
  
  <rect x="50" y="140" width="1100" height="200" rx="8" fill="#e7f5ff" stroke="#1971c2" stroke-width="3"/>
  
  <!-- Block 0 -->
  <rect x="80" y="170" width="220" height="140" rx="6" fill="#d0ebff" stroke="#1864ab" stroke-width="2"/>
  <text x="190" y="200" text-anchor="middle" class="label-bold">Block 0</text>
  <text x="190" y="230" text-anchor="middle" class="code" fill="#1864ab">blockIdx.x = 0</text>
  <text x="190" y="285" text-anchor="middle" class="label" font-size="14">Each block contains</text>
  <text x="190" y="305" text-anchor="middle" class="label" font-size="14" font-weight="bold">256 threads</text>
  
  <!-- Block 1 -->
  <rect x="330" y="170" width="220" height="140" rx="6" fill="#d0ebff" stroke="#1864ab" stroke-width="2"/>
  <text x="440" y="200" text-anchor="middle" class="label-bold">Block 1</text>
  <text x="440" y="230" text-anchor="middle" class="code" fill="#1864ab">blockIdx.x = 1</text>
  <text x="440" y="285" text-anchor="middle" class="label" font-size="14">Each block contains</text>
  <text x="440" y="305" text-anchor="middle" class="label" font-size="14" font-weight="bold">256 threads</text>
  
  <!-- Block 2 (HIGHLIGHTED) -->
  <rect x="580" y="170" width="220" height="140" rx="6" fill="#ffe3e3" stroke="#f03e3e" stroke-width="4"/>
  <text x="690" y="200" text-anchor="middle" class="label-bold" fill="#c92a2a">Block 2 ‚≠ê</text>
  <text x="690" y="230" text-anchor="middle" class="code" fill="#c92a2a" font-weight="bold">blockIdx.x = 2</text>
  <text x="690" y="285" text-anchor="middle" class="label" font-size="14">Each block contains</text>
  <text x="690" y="305" text-anchor="middle" class="label" font-size="14" font-weight="bold">256 threads</text>
  
  <!-- Block 3 -->
  <rect x="830" y="170" width="220" height="140" rx="6" fill="#d0ebff" stroke="#1864ab" stroke-width="2"/>
  <text x="940" y="200" text-anchor="middle" class="label-bold">Block 3</text>
  <text x="940" y="230" text-anchor="middle" class="code" fill="#1864ab">blockIdx.x = 3</text>
  <text x="940" y="285" text-anchor="middle" class="label" font-size="14">Each block contains</text>
  <text x="940" y="305" text-anchor="middle" class="label" font-size="14" font-weight="bold">256 threads</text>
  
  <text x="1080" y="185" class="code" fill="#1971c2" font-size="14">gridDim.x = 4</text>
  <text x="1080" y="210" class="label" font-size="13">(4 blocks total)</text>
  
  <!-- ============ STEP 2: Zoom into Block 2 ============ -->
  <text x="50" y="390" class="section-title">Step 2: Threads Inside Block 2</text>
  
  <rect x="50" y="410" width="1100" height="260" rx="8" fill="#fff5f5" stroke="#f03e3e" stroke-width="3"/>
  
  <text x="600" y="445" text-anchor="middle" class="label-bold" fill="#c92a2a">Block 2 contains 256 threads (organized as 16√ó16 grid)</text>
  <text x="600" y="470" text-anchor="middle" class="code" fill="#495057">blockDim.x = 256 (for 1D) or blockDim = (16, 16) for 2D</text>
  
  <!-- Thread grid visualization (16x16 but show subset) -->
  <g transform="translate(200, 500)">
    <!-- Show first few rows/columns -->
    <text x="0" y="-10" class="label" font-size="13" fill="#868e96">threadIdx.x ‚Üí</text>
    <text x="-80" y="80" class="label" font-size="13" fill="#868e96">threadIdx.y ‚Üì</text>
    
    <!-- Row labels -->
    <text x="-25" y="18" class="code" font-size="12">0</text>
    <text x="-25" y="43" class="code" font-size="12">1</text>
    <text x="-25" y="68" class="code" font-size="12">2</text>
    <text x="-25" y="120" class="code" font-size="12">...</text>
    
    <!-- Column labels -->
    <text x="8" y="-5" class="code" font-size="12">0</text>
    <text x="33" y="-5" class="code" font-size="12">1</text>
    <text x="58" y="-5" class="code" font-size="12">2</text>
    <text x="83" y="-5" class="code" font-size="12">3</text>
    <text x="108" y="-5" class="code" font-size="12">4</text>
    <text x="133" y="-5" class="code" font-size="12">5</text>
    <text x="183" y="-5" class="code" font-size="12">...</text>
    <text x="233" y="-5" class="code" font-size="12">15</text>
    
    <!-- Thread cells (show sample) -->
    <rect x="0" y="0" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="25" y="0" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="50" y="0" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="75" y="0" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="100" y="0" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="125" y="0" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <text x="180" y="15" class="label" font-size="12">...</text>
    <rect x="230" y="0" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    
    <rect x="0" y="25" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="25" y="25" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="50" y="25" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="75" y="25" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="100" y="25" width="22" height="22" fill="#ffd43b" stroke="#f76707" stroke-width="3"/>
    <text x="111" y="40" class="highlight" font-size="11" text-anchor="middle" font-weight="bold">‚≠ê</text>
    <rect x="125" y="25" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <text x="180" y="40" class="label" font-size="12">...</text>
    <rect x="230" y="25" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    
    <rect x="0" y="50" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="25" y="50" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="50" y="50" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="75" y="50" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="100" y="50" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="125" y="50" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <text x="180" y="65" class="label" font-size="12">...</text>
    <rect x="230" y="50" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    
    <text x="11" y="110" class="label" font-size="14">‚ãÆ</text>
    <text x="36" y="110" class="label" font-size="14">‚ãÆ</text>
    <text x="61" y="110" class="label" font-size="14">‚ãÆ</text>
    <text x="86" y="110" class="label" font-size="14">‚ãÆ</text>
    <text x="111" y="110" class="label" font-size="14">‚ãÆ</text>
    <text x="136" y="110" class="label" font-size="14">‚ãÆ</text>
    <text x="241" y="110" class="label" font-size="14">‚ãÆ</text>
    
    <rect x="0" y="130" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="25" y="130" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="50" y="130" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="75" y="130" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="100" y="130" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <rect x="125" y="130" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
    <text x="180" y="145" class="label" font-size="12">...</text>
    <rect x="230" y="130" width="22" height="22" fill="#d3f9d8" stroke="#2f9e44" stroke-width="1"/>
  </g>
  
  <!-- Highlight explanation -->
  <rect x="550" y="510" width="550" height="120" rx="6" fill="#fff9db" stroke="#f59f00" stroke-width="2"/>
  <text x="825" y="540" text-anchor="middle" class="highlight">‚≠ê Let's find the global index of this thread!</text>
  <text x="825" y="570" text-anchor="middle" class="code" fill="#1e1e1e">threadIdx.x = 4 (column 4)</text>
  <text x="825" y="595" text-anchor="middle" class="code" fill="#1e1e1e">threadIdx.y = 1 (row 1)</text>
  <text x="825" y="620" text-anchor="middle" class="label" font-size="14">For 1D: threadIdx.x = 1√ó16 + 4 = 20</text>
  
  <!-- ============ STEP 3: The Formula ============ -->
  <text x="50" y="720" class="section-title">Step 3: Calculate Global Thread Index</text>
  
  <rect x="50" y="740" width="1100" height="320" rx="8" fill="#e7f5ff" stroke="#1971c2" stroke-width="3"/>
  
  <!-- Visual explanation -->
  <g transform="translate(100, 780)">
    <!-- All blocks before Block 2 -->
    <rect x="0" y="0" width="180" height="80" rx="4" fill="#adb5bd" stroke="#495057" stroke-width="2"/>
    <text x="90" y="30" text-anchor="middle" class="label-bold" font-size="14">Block 0</text>
    <text x="90" y="50" text-anchor="middle" class="code" font-size="13">256 threads</text>
    <text x="90" y="70" text-anchor="middle" class="code" font-size="13" fill="#495057">(IDs 0-255)</text>
    
    <rect x="200" y="0" width="180" height="80" rx="4" fill="#adb5bd" stroke="#495057" stroke-width="2"/>
    <text x="290" y="30" text-anchor="middle" class="label-bold" font-size="14">Block 1</text>
    <text x="290" y="50" text-anchor="middle" class="code" font-size="13">256 threads</text>
    <text x="290" y="70" text-anchor="middle" class="code" font-size="13" fill="#495057">(IDs 256-511)</text>
    
    <!-- Current block -->
    <rect x="400" y="0" width="180" height="80" rx="4" fill="#ffc9c9" stroke="#f03e3e" stroke-width="3"/>
    <text x="490" y="30" text-anchor="middle" class="label-bold" font-size="14" fill="#c92a2a">Block 2 ‚≠ê</text>
    <text x="490" y="50" text-anchor="middle" class="code" font-size="13">256 threads</text>
    <text x="490" y="70" text-anchor="middle" class="code" font-size="13" fill="#c92a2a">(IDs 512-767)</text>
    
    <!-- Arrow pointing to specific thread -->
    <line x1="490" y1="90" x2="490" y2="130" stroke="#f03e3e" stroke-width="3" marker-end="url(#arrow)"/>
    <text x="510" y="115" class="arrow-label">Our thread</text>
    
    <!-- Highlighted thread position in block -->
    <rect x="400" y="140" width="180" height="60" rx="4" fill="#fff3bf" stroke="#fab005" stroke-width="3"/>
    <text x="490" y="165" text-anchor="middle" class="code" font-size="13">Thread #20 in Block 2</text>
    <text x="490" y="185" text-anchor="middle" class="code" font-size="13" fill="#e67700">(threadIdx.x = 20)</text>
  </g>
  
  <!-- Formula box -->
  <rect x="100" y="930" width="1000" height="110" rx="6" fill="#fff9db" stroke="#fab005" stroke-width="3"/>
  <text x="600" y="960" text-anchor="middle" class="section-title" fill="#e67700">The Formula</text>
  
  <text x="150" y="995" class="code" fill="#1e1e1e" font-size="17">globalIdx = blockIdx.x √ó blockDim.x + threadIdx.x</text>
  <text x="150" y="1025" class="code" fill="#1e1e1e" font-size="17">          = 2 √ó 256 + 20  =  <tspan fill="#c92a2a" font-weight="bold">512 + 20  =  532 ‚úÖ</tspan></text>
  
  <!-- ============ STEP 4: Intuition ============ -->
  <text x="50" y="1110" class="section-title">Step 4: The Intuition üí°</text>
  
  <rect x="50" y="1130" width="1100" height="230" rx="8" fill="#f3f0ff" stroke="#7950f2" stroke-width="3"/>
  
  <g transform="translate(80, 1165)">
    <text x="0" y="0" class="label-bold" fill="#5f3dc4">Think of it like apartment buildings:</text>
    
    <rect x="0" y="15" width="480" height="60" rx="4" fill="#d0bfff" stroke="#7950f2" stroke-width="2"/>
    <text x="20" y="38" class="label">üè¢ <tspan font-weight="bold">blockIdx</tspan> = Which building (0, 1, 2, 3...)</text>
    <text x="20" y="60" class="label">Each building is identical!</text>
    
    <rect x="510" y="15" width="550" height="60" rx="4" fill="#d0bfff" stroke="#7950f2" stroke-width="2"/>
    <text x="530" y="38" class="label">üö™ <tspan font-weight="bold">threadIdx</tspan> = Apartment # within building (0-255)</text>
    <text x="530" y="60" class="label">Position inside your current building</text>
    
    <rect x="0" y="90" width="480" height="60" rx="4" fill="#d0bfff" stroke="#7950f2" stroke-width="2"/>
    <text x="20" y="113" class="label">üìè <tspan font-weight="bold">blockDim</tspan> = Apartments per building (256)</text>
    <text x="20" y="135" class="label">Always same size for all blocks!</text>
    
    <rect x="510" y="90" width="550" height="60" rx="4" fill="#ffe066" stroke="#fab005" stroke-width="3"/>
    <text x="530" y="113" class="label-bold" fill="#e67700">üéØ Global Index = Which apartment in entire city?</text>
    <text x="530" y="135" class="label">= (buildings before you √ó 256) + your apt #</text>
    
    <rect x="0" y="165" width="1040" height="50" rx="4" fill="#d3f9d8" stroke="#2f9e44" stroke-width="2"/>
    <text x="520" y="190" text-anchor="middle" class="code" font-size="15">Building 2, Apartment 20  ‚Üí  Global Apartment: (2 √ó 256) + 20 = 532</text>
    <text x="520" y="210" text-anchor="middle" class="label" font-size="14" fill="#2f9e44">This is the unique ID you use to access array[globalIdx]!</text>
  </g>
  
  <!-- Final note -->
  <rect x="50" y="1385" width="1100" height="10" rx="5" fill="url(#grad)" />
  <defs>
    <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1971c2;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#f03e3e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2f9e44;stop-opacity:1" />
    </linearGradient>
  </defs>
</svg>